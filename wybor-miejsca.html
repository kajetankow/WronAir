<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="shortcut icon" href="img/logo_16.ico">
  <link rel="shortcut icon" href="img/logo_32.ico">
  <title>WronAir | Miejsce</title>
  <link rel="stylesheet" href="style_wybor-miejsca.css" />
</head>
<body>
  <header class="header-with-logo">
    <!-- Kontener na logo -->
    <div class="logo-container">
      <a href="index.html">
        <img src="img/logociemne.jpg" alt="Logo WronAir" />
      </a>
    </div>

    <!-- Przycisk hamburger -->
    <button class="menu-toggle" id="menuToggle">
      <span class="hamburger-bar"></span>
      <span class="hamburger-bar"></span>
      <span class="hamburger-bar"></span>
    </button>

    <!-- Górny pasek -->
    <div class="top-bar">
      <div class="top-bar-content">
        <a href="#" class="login-link">Logowanie i rejestracja</a>
        <div class="language-switch">
          <button class="lang-btn" id="langButton">
            <img src="img/Flag_of_Poland.svg" alt="PL" class="flag" />
            PL
          </button>
          <ul class="language-dropdown" id="langDropdown">
            <li class="current-language">
              <a href="#">
                <img src="img/Flag_of_Poland.svg" alt="PL" class="flag" />
                PL
              </a>
            </li>
            <li>
              <a href="#">
                <img src="img/Flag_of_the_United_States.svg.png" alt="ENG" class="flag" />
                ENG
              </a>
            </li>
          </ul>
        </div>
      </div>
    </div>

    <!-- Pasek menu (desktop) -->
    <nav class="main-menu" id="mainNav">
      <ul class="nav-links">
        <li><a href="index.html">Strona Główna</a></li>
        <li><a href="#">Odpraw się</a></li>
        <li><a href="#">Upgrade</a></li>
        <li><a href="#">Usługi na Pokładzie</a></li>
        <li><a href="faq.html">FAQ</a></li>
        <li><a href="o_nas.html">O Nas</a></li>
      </ul>
    </nav>

    <!-- Menu mobilne -->
    <nav class="mobile-menu" id="mobileMenu">
      <ul>
        <li><a href="#">Logowanie i rejestracja</a></li>
        <li><a href="index.html">Strona Główna</a></li>
        <li><a href="#">Odpraw się</a></li>
        <li><a href="#">Upgrade</a></li>
        <li><a href="#">Usługi na Pokładzie</a></li>
        <li><a href="faq.html">FAQ</a></li>
        <li><a href="o_nas.html">O Nas</a></li>
        <li>
          <div class="language-switch-mobile">
            <button class="lang-btn" id="langButtonMobile">
              <img src="img/Flag_of_Poland.svg" alt="PL" class="flag" />
              PL
            </button>
            <ul class="language-dropdown" id="langDropdownMobile">
              <li class="current-language">
                <a href="#">
                  <img src="img/Flag_of_Poland.svg" alt="PL" class="flag" />
                  PL
                </a>
              </li>
              <li>
                <a href="#">
                  <img src="img/Flag_of_the_United_States.svg.png" alt="ENG" class="flag" />
                  ENG
                </a>
              </li>
            </ul>
          </div>
        </li>
      </ul>
    </nav>
  </header>

  <!-- Główna treść -->
  <main class="content">

    <!-- Sekcja wyboru miejsca -->
    <div class="line-container">
      <div class="text-linia">Wybór miejsca**</div>
      <div class="line-right"></div>
    </div>
    <p>Poniżej znajduje się mapa dostępnych miejsc. Wybierz swoje miejsce, aby podróż przebiegła w pełnym komforcie.</p>
    <h3>Lot <span id="flightCode">WR47</span></h3>
    <h3>Model samolotu: Airbus A330-300</h3>
    
    <!-- Tutaj wyświetlamy jakie miejsca są aktualnie zaznaczone -->
    <h3>Miejsca wybrane (dla <span id="passengersSpan"></span> pasażerów): 
      <span id="selectedSeat">NIE WYBRANO</span>
    </h3>

    <div class="background-wrapper">
      <div class="background-container"></div>
      <div class="content-wrapper">

        <!-- Klasa 1 (First Class) – w przykładzie wszystkie disabled -->
        <div class="class-section first-class">
          <div class="row">
            <button disabled>1A</button>
            <button disabled>1B</button>
            <button disabled>1C</button>
          </div>
          <div class="row">
            <button disabled>2A</button>
            <button disabled>2B</button>
            <button disabled>2C</button>
          </div>
          <div class="row">
            <button disabled>3A</button>
            <button disabled>3B</button>
            <button disabled>3C</button>
          </div>
          <div class="row">
            <button disabled>4A</button>
            <button disabled>4B</button>
            <button disabled>4C</button>
          </div>
          <div class="row">
            <button disabled>5A</button>
            <button disabled>5B</button>
            <button disabled>5C</button>
          </div>
        </div>

        <!-- Klasa ekonomiczna -->
        <div class="economy-class">
          <!-- Skrypt generujący miejsca w klasie ekonomicznej -->
          <script>
            const economyClassContainer = document.currentScript.parentNode;

            function createRow(rowNumber) {
              const row = document.createElement("div");
              row.className = "row economy-row";

              const seatLetters = ["A", "B", "C", "D", "E", "F", "G", "H"];
              seatLetters.forEach((seat, index) => {
                // Dodanie odstępu w układzie np. między C i D, G i H
                if (index === 2 || index === 6) {
                  const spacer = document.createElement("div");
                  spacer.className = "spacer";
                  row.appendChild(spacer);
                }
                // Tworzymy przycisk dla danego miejsca
                const button = document.createElement("button");
                button.textContent = `${rowNumber}${seat}`;

                // Losowe zajętości (przykładowo)
                if (Math.random() < 0.2) {
                  button.classList.add("occupied");
                  button.disabled = true;
                }

                row.appendChild(button);
              });

              return row;
            }

            // W przykładzie generujemy rzędy od 6 do 30
            for (let i = 6; i <= 30; i++) {
              // Możemy np. zrobić przerwę między 20 a 21
              if (i === 21) {
                const rowBreak = document.createElement("div");
                rowBreak.className = "row-break";
                economyClassContainer.appendChild(rowBreak);
              }
              economyClassContainer.appendChild(createRow(i));
            }
          </script>
        </div> <!-- /economy-class -->

      </div> <!-- /content-wrapper -->
    </div> <!-- /background-wrapper -->

    <!-- Legenda -->
    <div id="legend">
      <h3>Legenda</h3>
      <ul>
        <li>
          <span style="display: inline-block; width: 20px; height: 20px; background-color: green; margin-right: 10px; border: 1px solid black;"></span>
          Wybrane miejsce
        </li>
        <li>
          <span style="display: inline-block; width: 20px; height: 20px; background-color: red; margin-right: 10px; border: 1px solid black;"></span>
          Zajęte miejsce
        </li>
        <li>
          <span style="display: inline-block; width: 20px; height: 20px; background-color: #f0f0f0; margin-right: 10px; border: 1px solid black;"></span>
          Dostępne miejsce
        </li>
      </ul>
    </div>

    <div class="info-section">
      <p>Kliknij dowolne wolne miejsce, aby wybrać. <br>
      Możesz wybrać maksymalnie tyle miejsc, ilu jest pasażerów. <br>
      Jeśli nie dokonasz wyboru, miejsce zostanie przyznane losowo.</p>
      <p class="extra">
        **Wybór miejsca jest opcją dodatkowo płatną w wysokości 
        <strong>599 PLN (Economy)</strong> 
        lub 
        <strong>399 PLN (Premium Economy)</strong> 
        – w zależności od wykupionej klasy. 
        Możesz też wybrać miejsce bezpłatnie podczas odprawy online, 
        która rozpoczyna się na 24 godziny przed odlotem.
      </p>
    </div>

    <!-- Sekcja bagażu -->
    <div class="line-container">
      <div class="text-linia">BAGAŻ REJESTROWANY</div>
      <div class="line-right"></div>
    </div>

    <div id="passengers-container"></div>

    <!-- Pokazujemy całkowitą cenę -->
    <div class="price-container">
        <h2>Cena całkowita: <span class="price-value">0.00</span> PLN</h2>
        <div class="button-group">
          <a class="aboard" href="landing-page.html" type="button">Anuluj rezerwacje</a>
          <button id="confirmButton" type="button">Potwierdź</button>
        </div>
      </div>

  </main>

  <footer>
    <!-- Stopka -->
    <div class="footer-container search-bar-row">
      <div class="footer-column">
        <form class="search-bar">
          <input type="text" placeholder="Wprowadź szukany termin" />
          <button type="submit">
            <img src="img/search.png" alt="Szukaj" />
          </button>
        </form>
      </div>
      <div class="footer-column"></div>
      <div class="footer-column"></div>
    </div>
    <div class="footer-container">
      <div class="footer-column">
        <div class="footer-links">
          <a href="#">Odpraw się</a><br /><br />
          <a href="#">Upgrade</a><br /><br />
          <a href="#">Usługi na pokładzie</a><br /><br />
          <a href="faq.html">FAQ</a>
        </div>
        <p class="payment-title">Opcje płatności</p>
        <div class="payment-options">
          <a href="#"><img src="img/masterC.png" alt="Mastercard" /></a>
          <a href="#"><img src="img/visa.png" alt="Visa" /></a>
          <a href="#"><img src="img/ap.png" alt="Apple Pay" /></a>
          <a href="#"><img src="img/paypal.png" alt="Paypal" /></a>
          <a href="#"><img src="img/blik.png" alt="BLIK" /></a>
        </div>
      </div>
      <div class="footer-column">
        <div class="footer-links">
          <a href="o_nas.html">O nas</a><br /><br />
          <a href="#">Bagaż</a><br /><br />
          <a href="#">Informacje o odprawie</a><br /><br />
          <a href="#">Pomoc</a><br /><br />
          <a href="#">Posiłki i napoje</a><br /><br />
          <a href="#">Promocje i oferty</a>
        </div>
      </div>
      <div class="footer-column">
        <p class="social-title">Śledź nas</p>
        <div class="social-media">
          <a href="#"><img src="img/ig.png" alt="Instagram" /> @WronAir</a><br />
          <a href="#"><img src="img/twt.png" alt="Twitter" /> @WronAir</a><br />
          <a href="#"><img src="img/ln.png" alt="LinkedIn" /> @WronAir</a><br />
          <a href="#"><img src="img/facebook.png" alt="Facebook" /> @WronAir</a><br />
          <a href="#"><img src="img/yt.png" alt="YouTube" /> @WronAir</a>
        </div>
      </div>
    </div>
    <div class="footer-bottom">
      <p>&copy; WronAir.com 2024. Wszelkie prawa zastrzeżone.</p>
    </div>
  </footer>

  <div class="footer-logo">
    <img src="img/logojasne.jpg" alt="Logo WronAir">
  </div>

  <!-- Skrypty -->
  <script>
    // -----------------------------
    // ODCZYT PARAMETRÓW Z URL
    // -----------------------------
    function getAllQueryParams() {
      const params = new URLSearchParams(window.location.search);
      // Zwracamy obiekt klucz-wartość
      const result = {};
      for (const [key, value] of params.entries()) {
        result[key] = value;
      }
      return result;
    }

    const params = getAllQueryParams();

    // Podstawowe wartości z URL, potrzebne w logice
    const passengersCount = parseInt(params.passengers || "1", 10);
    const basePrice = parseFloat(params.price || "0");  
    const ticketType = (params.ticket_type || "ECONOMY").toUpperCase();

    // Ustawiamy domyślnie flight code, jeśli jest w parametrach
    if (params.flight_code) {
      const flightCodeElem = document.getElementById("flightCode");
      if (flightCodeElem) flightCodeElem.textContent = params.flight_code;
    }

    // Wyświetlamy, ile jest pasażerów
    const passengersSpan = document.getElementById("passengersSpan");
    if (passengersSpan) {
      passengersSpan.textContent = passengersCount;
    }

    // -----------------------------
    // MECHANIZM ZAZNACZANIA MIEJSC
    // -----------------------------
    let selectedSeats = [];


    document.addEventListener("click", (event) => {
    // Warunek sprawdza, czy kliknięto w BUTTON, który:
    // 1) jest wewnątrz kontenera .economy-class lub .first-class
    // 2) nie ma klasy .occupied (zajęte miejsce)
    // 3) nie jest disabled
    if (
        event.target.matches(".economy-class button, .first-class button") &&
        !event.target.classList.contains("occupied") &&
        !event.target.disabled
    ) {
        const seat = event.target.textContent; // np. "12A"

        // Sprawdź, czy to miejsce jest już w tablicy
        const index = selectedSeats.indexOf(seat);

        if (index >= 0) {
        // Jeśli było już wybrane, to je odznaczamy
        selectedSeats.splice(index, 1);
        event.target.classList.remove("selected");
        } else {
        // Jeśli nie było w tablicy
        if (selectedSeats.length < passengersCount) {
            // Jeśli wciąż mamy wolne "sloty" do wyboru
            selectedSeats.push(seat);
            event.target.classList.add("selected");
        } else {
            // Mamy już maksymalną liczbę miejsc -> zamieniamy najstarsze na nowe
            const oldestSeat = selectedSeats.shift(); // "zdejmujemy" pierwsze
            // Szukamy w interfejsie przycisku dla najstarszego miejsca i usuwamy zaznaczenie
            const oldestBtn = [...document.querySelectorAll("button.selected")]
            .find((btn) => btn.textContent === oldestSeat);
            if (oldestBtn) {
            oldestBtn.classList.remove("selected");
            }
            // Dodajemy nowo kliknięte miejsce
            selectedSeats.push(seat);
            event.target.classList.add("selected");
        }
        }

        // Aktualizujemy wyświetlanie wybranych miejsc w elemencie #selectedSeat
        const selectedSeatSpan = document.getElementById("selectedSeat");
        if (selectedSeats.length === 0) {
        selectedSeatSpan.textContent = "NIE WYBRANO";
        } else {
        selectedSeatSpan.textContent = selectedSeats.join(", ");
        }
    }
    });

    // -----------------------------
    // MECHANIZM BAGAŻU
    // -----------------------------
    const passengersContainer = document.getElementById('passengers-container');

    // Funkcja tworząca sekcję bagażu dla pasażera
    function createPassengerSection(passengerNumber) {
      const container = document.createElement('div');
      container.classList.add('baggage-container');

      // Generujemy unikalne ID do licznika bagażu
      const baggageCounterId = `baggageCounter${passengerNumber}`;

      container.innerHTML = `
        <p class="passenger-label">Pasażer ${passengerNumber}</p>
        <div class="baggage-header">
          <h2>POSIADANE SZTUKI BAGAŻU REJESTROWANEGO:</h2>
          <div class="counter">
            <button type="button" onclick="updateCounter('${baggageCounterId}', -1)">-</button>
            <span id="${baggageCounterId}">0</span>
            <button type="button" onclick="updateCounter('${baggageCounterId}', 1)">+</button>
          </div>
        </div>
        <p class="baggage-info">
          Bagaż rejestrowany to bagaż nadawany do luku bagażowego. Maksymalna waga jednej sztuki bagażu: 23 kg, 
          wymiary: do 70x50x38 cm.<br>
          *Każda dodatkowa sztuka bagażu rejestrowanego (niewliczona w cenę biletu) kosztuje 600 PLN.
        </p>
        <p class="extra-info">Możesz wybrać od 0 do 2 sztuk bagażu.</p>
      `;

      passengersContainer.appendChild(container);
    }

    // Generowanie sekcji dla każdego pasażera
    for (let i = 1; i <= passengersCount; i++) {
      createPassengerSection(i);
    }

    // Funkcja obsługująca licznik bagażu
    function updateCounter(spanId, change) {
      const counterSpan = document.getElementById(spanId);
      let count = parseInt(counterSpan.textContent, 10);
      count += change;

      if (count < 0) count = 0;
      if (count > 2) count = 2;

      counterSpan.textContent = count;
    }
    // Ustawiamy funkcję globalnie (na window), aby była dostępna w onclick
    window.updateCounter = updateCounter;

    // -----------------------------
    // LICZENIE CENY CAŁKOWITEJ
    // -----------------------------
    function calculateTotalPrice() {
      // Podstawa to basePrice
      let total = basePrice;

      // Doliczanie kosztu wybranego miejsca (jeśli w ogóle jest wybór)
      // - w zależności od klasy tarfy (Economy czy Premium Economy)
      //   zakładamy 599 dla Economy, 399 dla Premium Economy
      let seatCost = 0;
      if (selectedSeats.length > 0) {
        if (ticketType.includes("PREMIUM")) {
          seatCost = 399 * selectedSeats.length;
        } else {
          // Domyślnie ECONOMY
          seatCost = 599 * selectedSeats.length;
        }
      }
      total += seatCost;

      // Doliczanie kosztu bagażu
      // Tu zakładamy uproszczenie: w Economy wszystko płatne, w Premium np. 1 sztuka darmowa (zależy od polityki).
      // Ale w Twoim kodzie sugeruje się, że każda sztuka bagażu niewliczona jest płatna 600 PLN. 
      // Można dodać warunki w zależności od ticketType (np. premium może mieć 1 darmową sztukę).
      
      let freeBags = 0; // Ilość darmowych sztuk w zależności od klasy
      if (ticketType.includes("PREMIUM")) {
        freeBags = 1; // Przykład: Premium Economy ma 1 darmową sztukę
      } 
      // Economy = 0 darmowych (przykład)

      let totalBaggageCost = 0;
      const baggageDivs = document.querySelectorAll('.baggage-container .counter span');
      baggageDivs.forEach(span => {
        const baggageCount = parseInt(span.textContent, 10) || 0;
        // Odliczamy darmowe
        const paidBags = Math.max(0, baggageCount - freeBags);
        // Każda płatna sztuka 600 PLN
        totalBaggageCost += paidBags * 600;
      });
      total += totalBaggageCost;

      return total;
    }

    // -----------------------------
    // AKTUALIZACJA CENY NA EKRANIE
    // -----------------------------
    function updatePriceDisplay() {
      const priceElement = document.querySelector('.price-value');
      if (priceElement) {
        const total = calculateTotalPrice();
        priceElement.textContent = total.toFixed(2);
      }
    }

    // Aktualizujemy cenę za każdym razem, gdy użytkownik coś kliknie
    document.body.addEventListener("click", (event) => {
      // Jeśli klikanie może wpłynąć na cenę (wybór miejsca lub bagażu) – liczymy od nowa.
      // Najprostsze podejście: zawsze aktualizujemy cenę przy *każdym* kliknięciu.
      // Oczywiście można by nasłuchiwać tylko konkretnych elementów.
      updatePriceDisplay();
    });

    // Od razu przy wczytaniu strony
    updatePriceDisplay();

    // -----------------------------
    // PRZYCISK "Potwierdź" – przejście dalej
    // -----------------------------
    document.getElementById("confirmButton").addEventListener("click", () => {
      // Obliczamy cenę
      const finalPrice = calculateTotalPrice();

      // Budujemy listę bagaży
      const baggageCounts = [];
      const baggageSpans = document.querySelectorAll('.baggage-container .counter span');
      baggageSpans.forEach(span => {
        baggageCounts.push(span.textContent);
      });

      // Zapisujemy nowe informacje do naszego obiektu params
      // - seats
      // - baggage
      // - final price
      params.finalPrice = finalPrice.toFixed(2);
      params.selectedSeats = selectedSeats.join(","); 
      // Można też parametryzować liczbę miejsc w inny sposób, np. selectedSeat1, selectedSeat2, ...
      // Ale najprościej łączyć w jeden string.

      // Bagaże – np. w formie przecinków
      // lub JSON-a. Tutaj zrobimy listę rozdzielaną myślnikami:
      params.baggageCounts = baggageCounts.join("-");

      // Konstruujemy nowy URL na kolejną stronę (np. boarding_pass.html)
      // ale może to być dowolna strona (np. "podsumowanie.html")
      const nextPage = "boarding_pass.html";

      // Tworzymy obiekt URLSearchParams z "params"
      const newParams = new URLSearchParams();
      for (const key in params) {
        newParams.append(key, params[key]);
      }

      const newUrl = nextPage + "?" + newParams.toString();

      // Przechodzimy na kolejną stronę
      window.location.href = newUrl;
    });

    // -----------------------------
    // OBSŁUGA MENU/HAMBURGER I JĘZYK
    // -----------------------------
    document.addEventListener("DOMContentLoaded", function() {
      const menuToggle = document.getElementById("menuToggle");
      const mobileMenu = document.getElementById("mobileMenu");
      menuToggle.addEventListener("click", function() {
        mobileMenu.classList.toggle("open");
      });

      const langButton = document.getElementById("langButton");
      const langDropdown = document.getElementById("langDropdown");
      langButton.addEventListener("click", function() {
        langDropdown.classList.toggle("show");
      });

      const langButtonMobile = document.getElementById("langButtonMobile");
      const langDropdownMobile = document.getElementById("langDropdownMobile");
      langButtonMobile.addEventListener("click", function() {
        langDropdownMobile.classList.toggle("show");
      });
    });
  </script>
</body>
</html>
